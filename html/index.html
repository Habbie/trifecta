<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel='stylesheet' href='style.css'>
    <script defer src="logic.js"></script>
    <script defer src="cdn.min.js"></script>
  </head>
  <body>
    <div x-data="{ login: '', 
                 user: '', 
                 loggedon: false, 
                 imageid: '',
                 images: [],
                 can_touch_image: 0,
                 get canDelImage() { return( this.loggedon && this.imageid != '');},
                 get canShowImage() { return( this.imageid != '');} 
}"
         x-init="getLoginStatus($data)"
         @paste.window="getImage($data, $event)">
      <div style="float: right;">
        <table style="text-align: right;"><tr><td x-html="login"></td>
            <td><button x-cloak x-show="loggedon" @click="doLogout($data)">Logout</button></td>
            <td><form x-cloak @submit.prevent="doLogin($el, $data)" x-show="!loggedon">
          <label for="user">Username:</label>
          <input type="text" id="user" name="user" required>
          
          <label for="password">Password:</label>
          <input type="password" id="password" name="password" required>
          
          <button type="submit">Login</button>
        </form></td></tr></table>
      </div>
      <p x-show="!loggedon">&nbsp;</p>

      <button @click="doDeleteImage($data, imageid)" x-show="can_touch_image">Delete image</button>
      <br/>
      <div x-show="canShowImage">
        <img style="max-width: 100%" x-cloak x-bind:src="'i/'+imageid">
         <p contenteditable="true">...</p>
        
      </div>
      <h1 x-show="loggedon">Paste your image here</h1>
      <div x-show="loggedon">
        <button @click="getMyImageList($data)">List</button>
        <table>
          <tr>
            <th>Timestamp</th>
            <th>ID</th>
            <th>Type</th>
            <th>Size</th>
            <th>Public</th>
            <th>Until</th>
            <th>Thumbnail</th>
            <th>Del</th>
          </tr>
          <template x-for="g in images">
            <tr>
              <td x-text="new Date(g.timestamp * 1000).toLocaleString()"></td>
              <td x-text="g.id"></td>
              <td x-text="g.type"></td>
              <td x-text="g.size"></td>
              <td><input @click.prevent="doChangePublic($data, g.id, $el)" type="checkbox" x-bind:checked="g.public"/></td>
              <td x-text="if(g.publicUntilTstamp>0) return new Date(g.publicUntilTstamp * 1000).toLocaleString()"></td>              
              <td><a x-bind:href="'index.html?i='+g.id"><img loading="lazy" style="max-width: 150px;" x-bind:src="'i/'+g.id"></a></td>
              <td><a href='#' @click.prevent="doDeleteImage($data, g.id).then(r => getMyImageList($data))">x</td>
            </tr>
          </template>
        </table>
      </div>
    </div>
</body>
</html>
